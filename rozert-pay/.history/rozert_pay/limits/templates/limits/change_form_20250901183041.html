{% extends "admin/change_form.html" %}
{% load i18n static %}

{% block admin_change_form_document_ready %}
{{ block.super }}
<script type="text/javascript">
(function($) {
    $(document).ready(function() {
        function toggleFields() {
            const limitType = $('#id_limit_type').val();
            const fieldVisibility = {
                'max_successful_deposits': ['max_operations', 'period'],
                'max_overall_decline_percent': ['max_overall_decline_percent', 'period'],
                'max_withdrawal_decline_percent': ['max_withdrawal_decline_percent', 'period'],
                'max_deposit_decline_percent': ['max_deposit_decline_percent', 'period'],
                'min_amount_single_operation': ['min_amount'],
                'max_amount_single_operation': ['max_amount'],
                'total_amount_deposits_period': ['total_amount', 'period'],
                'total_amount_withdrawals_period': ['total_amount', 'period'],
                'max_withdrawal_to_deposit_ratio': ['max_ratio', 'period'],
                'max_operations_burst': ['max_operations', 'burst_minutes']
            };
            const allFields = [
                'max_operations', 'max_overall_decline_percent', 'max_withdrawal_decline_percent',
                'max_deposit_decline_percent', 'min_amount', 'max_amount', 'total_amount',
                'max_ratio', 'burst_minutes', 'period'
            ];

            allFields.forEach(function(field) {
                $('#id_' + field).closest('.form-row').hide();
            });

            const visibleFields = fieldVisibility[limitType] || [];
            visibleFields.forEach(function(field) {
                $('#id_' + field).closest('.form-row').show();
            });
            if (limitType === 'min_amount_single_operation' || limitType === 'max_amount_single_operation') {
                $('#id_period').closest('.form-row').hide();
            }
        }
        $('#id_limit_type').change(toggleFields);
        toggleFields();

        const cancelText = "{% translate 'Cancel' %}";
        const originalColor = '#ba2121';
        const hoverColor = '#a41515';

        const cancelButton = $('<input type="button" value="' + cancelText + '" onclick="window.history.back();" name="_cancel">')
            .addClass('button')
            .css('background', originalColor);

        cancelButton.hover(
            function() {
                $(this).css('background', hoverColor);
            },
            function() {
                $(this).css('background', originalColor);
            }
        );

        $('input[name="_continue"]').after(cancelButton);
    });
})(django.jQuery);
</script>
{% endblock %}
